依赖服务命令：

export HOST_IP=192.168.137.2

docker compose -p environment -f docker-compose.env.yaml up -d

docker compose -p environment -f docker-compose.env.yaml down

业务服务：

docker compose -p services -f docker-compose.service.yaml up -d

docker compose -p services -f docker-compose.service.yaml down



CURL失败排查思路：

1. 服务启动失败
2. 未关闭防火墙或开放相关端口
   1. 添加防火墙规则
   2. 服务设置监听IP0.0.0.0
3. 权限不够
4. jvm内存不足



Nacos排错经历：

1. 检查nacos服务是否已启动

   ```
   ps -ef | grep nacos
   
   docker logs nacos # 查看日志是否有报错
   ```

2. 检查端口是否正确监听

   ```
   netstat -tulnp | grep 8848
   ```

3. 检查防火墙是否正常访问

   ```
   systemctl status firewalld # 查询防火墙状态 开启/关闭
   
   firewall-cmd --add-port=8848/tcp --permanent # 添加放行端口
   firewall-cmd --reload # 重启防火墙
   
   systemctl stop firewalld # 临时关闭防火墙（测试用）
   ```

4. 检查 Nacos 是否绑定到 0.0.0.0

   如果 Nacos 只绑定到 127.0.0.1 或某个特定 IP，外部无法访问。

   修改配置文件，允许所有ip访问：

   ```bash
   ports:
         - "0.0.0.0:8848:8848"
         - "0.0.0.0:9848:9848"
         - "0.0.0.0:9849:9849"
   ```

5. 检查 SELinux 是否阻止访问

   ```bash
   getenforce  # 查看 SELinux 状态
   
   # 如果是Enforcing，临时关闭
   setenforce 0
   
   # 或永久关闭（需重启）：
   sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config
   ```

6. 是否正确连接到MySQL：

   检查custom.env文件，url，用户名密码等是否配置正确

   url建议用内部名称或具体IP(host.docker.internal也可以)，不建议使用localhost或127.0.0.1

7. 重启docker服务

   Docker 服务重启会重建默认的 iptables 规则链：

   ```bash
   systemctl restart docker
   ```

8. 赋予数据文件夹权限

   ```
   # 修改权限（允许 Elasticsearch 用户读写）
   sudo chmod 777 -R /mydata/elasticsearch  # 临时方案，生产环境建议精细化控制
   # 或
   sudo chown -R 1000:1000 /mydata/elasticsearch  # 直接归属给 Elasticsearch 用户
   ```

9. 当前版本不兼容（升级版本或选择与依赖服务对应版本）



elasticsearch启动失败：

1. **`NoShardAvailableActionException`**，分片未正确分配或节点离线。

   ```
   # 删除旧索引（例如：清理 .kibana_task_manager 的历史版本）
   curl -X DELETE "http://localhost:9200/.kibana_task_manager_旧版本号"
   curl -X DELETE "http://localhost:9200/.kibana_旧版本号"
   
   # 对所有索引解除只读（需先清理磁盘）
   curl -X PUT "http://localhost:9200/_all/_settings" -H 'Content-Type: application/json' -d'
   {
     "index.blocks.read_only_allow_delete": null
   }
   '
   ```

   

redis初始化集群

```
docker exec -it redis-node-1 redis-cli --cluster create \
  ${HOST_IP}:7001 \
  ${HOST_IP}:7002 \
  ${HOST_IP}:7003 \
  ${HOST_IP}:7004 \
  ${HOST_IP}:7005 \
  ${HOST_IP}:7006 \
  --cluster-replicas 1 --cluster-yes
```

